<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>XO Multiplayer</title>
  <style>
    body { font-family: Arial; text-align: center; background: #f0f0f0; }
    h1 { margin-top: 20px; }
    #board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; justify-content: center; margin: 20px auto; }
    .cell {
      width: 100px; height: 100px;
      background: white; border: 2px solid #ccc;
      font-size: 40px; display: flex;
      align-items: center; justify-content: center;
      cursor: pointer;
    }
    #status { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>لعبة XO جماعية</h1>
  <div id="status">جاري الاتصال بالخادم...</div>
  <div id="board"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const board = document.getElementById("board");
    const status = document.getElementById("status");
    let mark = "";
    let canPlay = false;

    for (let i = 0; i < 9; i++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.dataset.index = i;
      board.appendChild(cell);
    }

    socket.on("waiting", () => {
      status.textContent = "في انتظار لاعب آخر...";
    });

    socket.on("startGame", (data) => {
      mark = data.mark;
      canPlay = (mark === "X");
      status.textContent = "اللعبة بدأت! دورك: " + mark;
    });

    socket.on("moveMade", ({ index, mark: m }) => {
      const cell = board.children[index];
      cell.textContent = m;
      canPlay = (m !== mark);
      if (!checkGameEnd()) {
        status.textContent = canPlay ? "دورك" : "انتظر الخصم...";
      }
    });

    socket.on("gameOver", ({ winner }) => {
      if (winner) {
        status.textContent = winner === mark ? "فزت!" : "خسرت!";
      } else {
        status.textContent = "تعادل!";
      }
      canPlay = false;
    });

    socket.on("playerLeft", () => {
      status.textContent = "اللاعب الآخر غادر. انتظر لاعبا جديدا...";
      for (let cell of board.children) cell.textContent = "";
      canPlay = false;
    });

    socket.on("full", () => {
      status.textContent = "الغرفة ممتلئة، حاول لاحقًا.";
    });

    board.addEventListener("click", (e) => {
      const cell = e.target;
      const index = cell.dataset.index;
      if (!canPlay || cell.textContent) return;
      socket.emit("makeMove", parseInt(index));
    });

    function checkGameEnd() {
      let filled = 0;
      for (let cell of board.children) if (cell.textContent) filled++;
      return filled === 9;
    }
  </script>
</body>
</html>
