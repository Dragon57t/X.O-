<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>XO Game</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    .board { display: grid; grid-template-columns: repeat(3, 100px); margin: auto; gap: 5px; margin-top: 20px; }
    .cell {
      width: 100px; height: 100px; font-size: 40px;
      display: flex; align-items: center; justify-content: center;
      border: 1px solid #333; cursor: pointer;
    }
    .disabled { pointer-events: none; background: #eee; }
  </style>
</head>
<body>

<h1>لعبة XO</h1>
<p id="status">جاري الاتصال...</p>

<div class="board" id="board"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const board = document.getElementById("board");
const status = document.getElementById("status");

let mark = "";
let myTurn = false;

// إنشاء مربعات اللوحة
for (let i = 0; i < 9; i++) {
  const cell = document.createElement("div");
  cell.classList.add("cell");
  cell.dataset.index = i;
  cell.addEventListener("click", () => {
    if (myTurn && cell.textContent === "") {
      socket.emit("makeMove", parseInt(cell.dataset.index));
    }
  });
  board.appendChild(cell);
}

socket.on("waiting", () => {
  status.textContent = "في انتظار لاعب آخر...";
});

socket.on("startGame", (data) => {
  mark = data.mark;
  status.textContent = `اللعبة بدأت! أنت تلعب: ${mark}`;
});

socket.on("yourTurn", (turn) => {
  myTurn = turn;
  status.textContent = turn ? "دورك الآن" : "انتظر خصمك...";
});

socket.on("moveMade", ({ index, mark }) => {
  board.children[index].textContent = mark;
});

socket.on("gameOver", ({ winner }) => {
  if (winner === null) {
    status.textContent = "انتهت اللعبة: تعادل!";
  } else {
    status.textContent = `انتهت اللعبة! الفائز هو: ${winner}`;
  }
  myTurn = false;
});

socket.on("playerLeft", () => {
  status.textContent = "اللاعب الآخر خرج، بانتظار لاعب جديد...";
  [...board.children].forEach(c => c.textContent = "");
});

socket.on("full", () => {
  status.textContent = "الغرفة ممتلئة! الرجاء المحاولة لاحقًا.";
});
</script>

</body>
</html>
